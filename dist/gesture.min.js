/*! gesture @version 1.0.2 2013-05-26 */
/* @author: Li Chang Wei <lichangwei@love.com> */
/* @see https://github.com/lichangwei/gesture.git */
(function(){"use strict";function t(t,e){m.prototype[t]=function(n,r,a,o){"string"!=typeof n&&(o=a,a=r,r=n,n=void 0),"object"!=typeof r&&(o=a,a=r,r=void 0);for(var i=n?f(t,n,a):a,u=0;this.elems.length>u;u++){var c=this.elems[u];e&&e.call(c,t),c.addEventListener(t,i,!1);var s=y[c._gesture_id];s.push({type:t,selector:n,namespace:o,callback:i,original:a,data:r}),s._counter[t]=(s._counter[t]||0)+1}return this}}function e(t){t._gesture_id=++E;var e,r,u,c,s,f,h,l,p,v,d=y[t._gesture_id]=[],m=d._counter={},T=0,b={targets:[]};t.addEventListener(k,function(t){T=1,c=e=t.timeStamp,s=r=a(t),f=u=o(t);for(var i in _){var h=_[i];if("function"==typeof h.touchstart&&n(h.types,m)){var l=h.touchstart.call(this,t,b,e,r,u);if(l===!1)break}}},!1),t.addEventListener(w,function(t){if(T){c=t.timeStamp,s=a(t),f=o(t),h=c-e,l=s-r,p=f-u;for(var i in _){var g=_[i];if("function"==typeof g.touchmove&&n(g.types,m)){var v=g.touchmove.call(this,t,b,c,s,f,h,l,p);if(v===!1)break}}}},!1),t.addEventListener(S,function(t){if(T){c=t.timeStamp,h=c-e,l=s-r,p=f-u,v=Math.sqrt(l*l+p*p);for(var a in _){var o=_[a];if("function"==typeof o.touchend&&n(o.types,m)){var i=o.touchend.call(this,t,b,c,s,f,h,l,p,v);if(i===!1)break}}T=0}},!1),t.addEventListener(M,function(){T=0},!1),t.addEventListener("touchcancel",function(){T=0},!1),t.addEventListener(P,function(t){T=0;for(var e in _){var r=_[e];if("function"==typeof r.gesturestart&&n(r.types,m)){var a=r.gesturestart.call(this,t,b);if(a===!1)break}}},!1),t.addEventListener(D,function(t){T=0;for(var e in _){var r=_[e];if("function"==typeof r.gesturechange&&n(r.types,m)){var a=r.gesturechange.call(this,t,b);if(a===!1)break}}},!1),t.addEventListener(X,function(t){T=0;for(var e in _){var r=_[e];if("function"==typeof r.gestureend&&n(r.types,m)){var a=r.gestureend.call(this,t,b);if(a===!1)break}}},!1),x&&!L&&function(){var e,n,r;t.addEventListener(k,function(t){2>t.touches.length||(e=i(t),r=0,g(P,t,{scale:1,rotation:r}))},!1),t.addEventListener(w,function(t){if(!(2>t.touches.length)&&e){n=i(t);var a=n.angle-e.angle;r=a,g(D,t,{scale:n.distance/e.distance,rotation:a})}},!1),t.addEventListener(S,function(t){t.touches.length>0||e&&(g(X,t,{scale:n.distance/e.distance,rotation:r}),e=n=0)},!1)}()}function n(t,e){for(var n=0;t.length>n;n++)if(e[t[n]]>0)return!0;return!1}function r(t){if("undefined"!=typeof jQuery&&t instanceof jQuery?t=t.get():t instanceof HTMLElement||t===document?t=[t]:"string"==typeof t&&(t=document.querySelectorAll(t)),t instanceof NodeList||t instanceof HTMLCollection){for(var e=[],n=0;t.length>n;n++)e.push(t[n]);t=e}return t}function a(t){return t.pageX||t.clientX||(t.touches&&t.touches[0]?t.touches[0].pageX:0)||(t.changedTouches&&t.changedTouches[0]?t.changedTouches[0].pageX:0)}function o(t){return t.pageY||t.clientY||(t.touches&&t.touches[0]?t.touches[0].pageY:0)||(t.changedTouches&&t.changedTouches[0]?t.changedTouches[0].pageY:0)}function i(t){var e=t.touches[0],n=t.touches[1],r=[e.pageX,e.pageY],a=[n.pageX,n.pageY];return{distance:c(r,a),angle:u(r,a)}}function u(t,e){var n=t[0]-e[0],r=t[1]-e[1];return 0===n?0===r?0:r>0?90:-90:180*Math.atan(r/n)/Math.PI}function c(t,e){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function s(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function f(t,e,n){var r=n._g_cbs=n._g_cbs||{},a=h(t,e);return r[a]||(r[a]=function(t){var r=this.querySelectorAll(e);if(0!==r.length){for(var a=[],o=0;r.length>o;o++)a.push(r[o]);for(var i,u=t.targets||t.target&&[t.target]||t.eventTarget&&[t.eventTarget],o=0;u&&u.length>o;o++){for(var c=u[o];c!==this;c=c.parentNode){if(!c)return;if(a.indexOf(c)>=0)break}if(c===this)return;if(i&&i!==c)return;i=c}t.isSimulated&&(t.target=i),i&&n.call(i,t)}}),r[a]}function h(t,e){return t+"-"+e}function l(t,e,n){s(this,n),this.type=t,this.originalEvent=e,this.target=e.target||e.currentTarget||document,this.currentTarget=n.eventTarget||e.currentTarget||document,this.pageX=a(e),this.pageY=o(e)}function g(t,e,n){if(n=n||{},e=e||{},b){var r=document.createEvent("CustomEvent");r.initCustomEvent(t,n.canBubble,!0,1)}else{var r=document.createEvent("UIEvent");r.initUIEvent(t,n.canBubble,!0,document.defaultView,1)}s(r,n),r.originalEvent=e,r.isSimulated=!0,r.px=a(e),r.py=o(e);var i=n.eventTarget||e.currentTarget;(i||document).dispatchEvent(r)}function p(){return!0}function v(){return!1}function d(t){t.preventDefault()}var m=window.g=function(t){if(!(this instanceof m))return new m(t);var n=this.elems=r(t);if(n&&0!==n.length)for(var a=0;n.length>a;a++)n[a]._gesture_id||e(n[a])};m.version="1.0",m.prototype.on=function(t,e,n,r){var a=this;if(t.search(/\s/)>=0)return t.replace(/\S+/g,function(t){a.on(t,e,n,r)}),a;if(-1!==t.indexOf(".")){var o=t.split(".");t=o[0];var i=o[1]}var u=[];return e&&u.push(e),n&&u.push(n),r&&u.push(r),i&&u.push(i),a[t].apply(a,u),this},m.prototype.off=function(t,e,n){var r=this;if("function"==typeof e&&(n=e,e=null),t.search(/\s/)>=0)return t.replace(/\S+/g,function(t){r.off(t,e,n)}),r;if(-1!==t.indexOf(".")){var a=t.split(".");t=a[0];var o=a[1]}for(var i=0;this.elems.length>i;i++){var u=this.elems[i],c=y[u._gesture_id];if(c&&0!==c.length)for(var s=c.length-1;s>=0;s--){var f=c[s];t&&t!==f.type||e&&e!==f.selector||o&&o!==f.namespace||n&&n!==f.original||(u.removeEventListener(f.type,f.callback),c.splice(s,1),c._counter[t]--)}}return this},m.prototype.trigger=function(t){for(var e=0;this.elems.length>e;e++)g(t,null,{eventTarget:this.elems[e],canBubble:!0});return this},m.register=function(e,n,r){if(_[e])console.error('"'+e+'" cannot be regiested twice.');else{_[e]=n;for(var a=n.types=e.split(/\s/),o=0;a.length>o;o++)t(a[o],r)}return this},m.unregister=function(t){delete _[t],t=t.split(/\s/);for(var e=0;t.length>e;e++)delete m.prototype[t[e]];return this},m.opt=function(t,e){if("string"==typeof t)return void 0===e?T[t]:T[t]=e;for(var n in t)T[n]=t[n]},m.createEvent=function(t,e,n){n=n||{},e=e||{};for(var r=new l(t,e,n),a=r.currentTarget,o=a._gesture_id||"",i=y[o]||[],u=0;i.length>u&&!r.isImmediatePropagationStopped();u++){var c=i[u];c.type===t&&(r.data=c.data,c.callback.call(a,r))}return this};var _={},y={},E=0,T={tap_max_distance:30,tap_max_duration:Number.MAX_VALUE,doubletap_max_interval:250,flick_min_x_or_y:30,dragstart_after_touchstart:300,zoomout_max_scale:.83,zoomin_min_scale:1.2},b=!!window.CustomEvent,x="ontouchstart"in document.documentElement,L="ongesturestart"in document.documentElement,k=x?"touchstart":"mousedown",w=x?"touchmove":"mousemove",S=x?"touchend":"mouseup",M=x?"touchleave":"mouseleave",P="gesturestart",D="gesturechange",X="gestureend";m.register("touchstart touchmove touchend mousedown mousemove mouseup click",{}),m.event={touchstart:k,touchmove:w,touchend:S},m.support={touch:x,gesture:L},m.util={arrayify:r,getPageX:a,getPageY:o,getDistance:c,extend:s,Event:l,preventDefault:d},l.prototype={preventDefault:function(){var t=this.originalEvent;t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){var t=this.originalEvent;t&&(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=p,this.stopPropagation()},isImmediatePropagationStopped:v,isSimulated:!0}})(),function(t){"use strict";function e(e,n,r){var a=r.targets;a.push(n.target),a.length>=2?(clearTimeout(r.timerTapDoubletap),t.createEvent("doubletap",n,{targets:r.targets}),a.length=0):1===a.length&&function(e,n){var r=e.currentTarget;n.timerTapDoubletap=setTimeout(function(){t.createEvent("tap",e,{eventTarget:r,targets:n.targets}),n.targets.length=0},t.opt("doubletap_max_interval"))}(n,r)}t.register("tap doubletap",{touchend:function(n,r,a,o,i,u,c,s,f){f>t.opt("tap_max_distance")||u>t.opt("tap_max_duration")||e(this,n,r)}})}(g),function(t){"use strict";t.opt("tap_max_duration",300),t.register("taphold",{touchstart:function(e,n){var r=e.currentTarget;n.timerTaphold=setTimeout(function(){t.createEvent("taphold",e,{eventTarget:r})},t.opt("tap_max_duration"))},touchmove:function(e,n,r,a,o,i,u,c){var s=Math.sqrt(u*u+c*c);s>t.opt("tap_max_distance")&&clearTimeout(n.timerTaphold)},touchend:function(t,e){clearTimeout(e.timerTaphold)}})}(g),function(t){"use strict";t.register("flick",{touchend:function(e,n,r,a,o,i,u,c){var s,f=t.opt("flick_min_x_or_y");Math.abs(u)>=Math.abs(c)?u>f?s="right":-f>u&&(s="left"):c>f?s="down":-f>c&&(s="up"),s&&t.createEvent("flick",e,{direction:s})}})}(g),function(){if(!g.support.touch){var t={};g(document).on("touchend","a",function(){t[this._gesture_id]=!0}).on("click","a",function(e){t[this._gesture_id]||e.preventDefault(),t[this._gesture_id]=!1})}}(g);
//@ sourceMappingURL=dist/gesture.min.js.map