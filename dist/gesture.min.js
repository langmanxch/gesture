/*! gesture @version 1.0.0 2013-04-10 */
/* @author: Li Chang Wei <lichangwei@love.com> */
/* @see https://github.com/lichangwei/gesture.git */
(function(){"use strict";function t(t,e){m.prototype[t]=function(n,r,a,o){"string"!=typeof n&&(o=a,a=r,r=n,n=void 0),"object"!=typeof r&&(o=a,a=r,r=void 0);for(var i=n?f(t,n,a):a,u=0;this.elems.length>u;u++){var c=this.elems[u];e&&e.call(c,t),c.addEventListener(t,i,!1);var s=y[c._gesture_id];s.push({type:t,selector:n,namespace:o,callback:i,original:a,data:r}),s._counter[t]=(s._counter[t]||0)+1}return this}}function e(t){t._gesture_id=++E;var e,r,u,c,s,f,l,g,p,v,d=y[t._gesture_id]=[],m=d._counter={},b=0;t.addEventListener(k,function(t){b=1,c=e=t.timeStamp,s=r=a(t),f=u=o(t);for(var i in _){var l=_[i];if("function"==typeof l.touchstart&&n(l.types,m)){var g=l.touchstart.call(this,t,e,r,u);if(g===!1)break}}},!1),t.addEventListener(w,function(t){if(b){c=t.timeStamp,s=a(t),f=o(t),l=c-e,g=s-r,p=f-u;for(var i in _){var h=_[i];if("function"==typeof h.touchmove&&n(h.types,m)){var v=h.touchmove.call(this,t,c,s,f,l,g,p);if(v===!1)break}}}},!1),t.addEventListener(S,function(t){if(b){c=t.timeStamp,l=c-e,g=s-r,p=f-u,v=Math.sqrt(g*g+p*p);for(var a in _){var o=_[a];if("function"==typeof o.touchend&&n(o.types,m)){var i=o.touchend.call(this,t,c,s,f,l,g,p,v);if(i===!1)break}}b=0}},!1),t.addEventListener(P,function(){b=0},!1),t.addEventListener("touchcancel",function(){b=0},!1),t.addEventListener(M,function(t){b=0;for(var e in _){var r=_[e];if("function"==typeof r.gesturestart&&n(r.types,m)){var a=r.gesturestart.call(this,t);if(a===!1)break}}},!1),t.addEventListener(X,function(t){b=0;for(var e in _){var r=_[e];if("function"==typeof r.gesturechange&&n(r.types,m)){var a=r.gesturechange.call(this,t);if(a===!1)break}}},!1),t.addEventListener(Y,function(t){b=0;for(var e in _){var r=_[e];if("function"==typeof r.gestureend&&n(r.types,m)){var a=r.gestureend.call(this,t);if(a===!1)break}}},!1),x&&!L&&function(){var e,n,r;t.addEventListener(k,function(t){2>t.touches.length||(e=i(t),r=0,h(M,t,{scale:1,rotation:r}))},!1),t.addEventListener(w,function(t){if(!(2>t.touches.length)&&e){n=i(t);var a=n.angle-e.angle;r=a,h(X,t,{scale:n.distance/e.distance,rotation:a})}},!1),t.addEventListener(S,function(t){t.touches.length>0||e&&(h(Y,t,{scale:n.distance/e.distance,rotation:r}),e=n=0)},!1)}()}function n(t,e){for(var n=0;t.length>n;n++)if(e[t[n]]>0)return!0;return!1}function r(t){if("undefined"!=typeof jQuery&&t instanceof jQuery?t=t.get():t instanceof HTMLElement||t===document?t=[t]:"string"==typeof t&&(t=document.querySelectorAll(t)),t instanceof NodeList||t instanceof HTMLCollection){for(var e=[],n=0;t.length>n;n++)e.push(t[n]);t=e}return t}function a(t){return t.pageX||t.clientX||(t.touches&&t.touches[0]?t.touches[0].pageX:0)||(t.changedTouches&&t.changedTouches[0]?t.changedTouches[0].pageX:0)}function o(t){return t.pageY||t.clientY||(t.touches&&t.touches[0]?t.touches[0].pageY:0)||(t.changedTouches&&t.changedTouches[0]?t.changedTouches[0].pageY:0)}function i(t){var e=t.touches[0],n=t.touches[1],r=[e.pageX,e.pageY],a=[n.pageX,n.pageY];return{distance:c(r,a),angle:u(r,a)}}function u(t,e){var n=t[0]-e[0],r=t[1]-e[1];return 0===n?0===r?0:r>0?90:-90:180*Math.atan(r/n)/Math.PI}function c(t,e){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function s(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function f(t,e,n){var r=n._g_cbs=n._g_cbs||{},a=l(t,e);return r[a]||(r[a]=function(t){var r=this.querySelectorAll(e);if(0!==r.length){for(var a=[],o=0;r.length>o;o++)a.push(r[o]);for(var i,u=t.targets||t.target&&[t.target]||t.eventTarget&&[t.eventTarget],o=0;u&&u.length>o;o++){for(var c=u[o];c!==this;c=c.parentNode){if(!c)return;if(a.indexOf(c)>=0)break}if(c===this)return;if(i&&i!==c)return;i=c}t.isSimulated&&(t.target=i),i&&n.call(i,t)}}),r[a]}function l(t,e){return t+"-"+e}function g(t,e,n){s(this,n),this.type=t,this.originalEvent=e,this.target=e.target||e.currentTarget||document,this.currentTarget=n.eventTarget||e.currentTarget||document,this.pageX=a(e),this.pageY=o(e)}function h(t,e,n){if(n=n||{},e=e||{},T){var r=document.createEvent("CustomEvent");r.initCustomEvent(t,n.canBubble,!0,1)}else{var r=document.createEvent("UIEvent");r.initUIEvent(t,n.canBubble,!0,document.defaultView,1)}s(r,n),r.originalEvent=e,r.isSimulated=!0,r.px=a(e),r.py=o(e);var i=n.eventTarget||e.currentTarget;(i||document).dispatchEvent(r)}function p(){return!0}function v(){return!1}function d(t){t.preventDefault()}var m=window.g=function(t){if(!(this instanceof m))return new m(t);var n=this.elems=r(t);if(n&&0!==n.length)for(var a=0;n.length>a;a++)n[a]._gesture_id||e(n[a])};m.version="1.0",m.prototype.on=function(t,e,n,r){var a=this;if(t.search(/\s/)>=0)return t.replace(/\S+/g,function(t){a.on(t,e,n,r)}),a;if(-1!==t.indexOf(".")){var o=t.split(".");t=o[0];var i=o[1]}return a[t](e,n,r,i),this},m.prototype.off=function(t,e,n){var r=this;if("function"==typeof e&&(n=e,e=null),t.search(/\s/)>=0)return t.replace(/\S+/g,function(t){r.off(t,e,n)}),r;if(-1!==t.indexOf(".")){var a=t.split(".");t=a[0];var o=a[1]}for(var i=0;this.elems.length>i;i++){var u=this.elems[i],c=y[u._gesture_id];if(c&&0!==c.length)for(var s=c.length-1;s>=0;s--){var f=c[s];t&&t!==f.type||e&&e!==f.selector||o&&o!==f.namespace||n&&n!==f.original||(u.removeEventListener(f.type,f.callback),c.splice(s,1),c._counter[t]--)}}return this},m.prototype.trigger=function(t){for(var e=0;this.elems.length>e;e++)h(t,null,{eventTarget:this.elems[e],canBubble:!0});return this},m.register=function(e,n,r){if(_[e])console.error('"'+e+'" cannot be regiested twice.');else{_[e]=n;for(var a=n.types=e.split(/\s/),o=0;a.length>o;o++)t(a[o],r)}return this},m.unregister=function(t){delete _[t],t=t.split(/\s/);for(var e=0;t.length>e;e++)delete m.prototype[t[e]];return this},m.opt=function(t,e){if("string"==typeof t)return void 0===e?b[t]:b[t]=e;for(var n in t)b[n]=t[n]},m.createEvent=function(t,e,n){n=n||{},e=e||{};for(var r=new g(t,e,n),a=r.currentTarget,o=a._gesture_id||"",i=y[o]||[],u=0;i.length>u&&!r.isImmediatePropagationStopped();u++){var c=i[u];c.type===t&&(r.data=c.data,c.callback.call(a,r))}return this};var _={},y={},E=0,b={tap_max_distance:30,tap_max_duration:Number.MAX_VALUE,doubletap_max_interval:250,flick_min_x_or_y:30,dragstart_after_touchstart:300,zoomout_max_scale:.83,zoomin_min_scale:1.2},T=!!window.CustomEvent,x="ontouchstart"in document.documentElement,L="ongesturestart"in document.documentElement,k=x?"touchstart":"mousedown",w=x?"touchmove":"mousemove",S=x?"touchend":"mouseup",P=x?"touchleave":"mouseleave",M="gesturestart",X="gesturechange",Y="gestureend";m.register("touchstart touchmove touchend mousedown mousemove mouseup click",{}),m.event={touchstart:k,touchmove:w,touchend:S},m.support={touch:x,gesture:L},m.util={arrayify:r,getPageX:a,getPageY:o,getDistance:c,extend:s,Event:g,preventDefault:d},g.prototype={preventDefault:function(){var t=this.originalEvent;t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){var t=this.originalEvent;t&&(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=p,this.stopPropagation()},isImmediatePropagationStopped:v,isSimulated:!0}})(),function(t){"use strict";function e(e,a){var o=e._gesture_id,i=n[o]||(n[o]=[]);i.push(a.target),i.length>=2?(clearTimeout(r[o]),t.createEvent("doubletap",a,{targets:n[o]}),n[o]=null):1===i.length&&function(e,a){var o=e.currentTarget;r[a]=setTimeout(function(){t.createEvent("tap",e,{eventTarget:o,targets:n[a]}),n[a]=null},t.opt("doubletap_max_interval"))}(a,o)}var n={},r={};t.register("tap doubletap",{touchend:function(n,r,a,o,i,u,c,s){s>t.opt("tap_max_distance")||i>t.opt("tap_max_duration")||e(this,n)}})}(g),function(t){"use strict";t.opt("tap_max_duration",300),t.register("taphold",{touchend:function(e,n,r,a,o,i,u,c){c>t.opt("tap_max_distance")||t.opt("tap_max_duration")>=o||t.createEvent("taphold",e)}})}(g),function(t){"use strict";t.register("flick",{touchend:function(e,n,r,a,o,i,u){var c,s=t.opt("flick_min_x_or_y");Math.abs(i)>=Math.abs(u)?i>s?c="right":-s>i&&(c="left"):u>s?c="down":-s>u&&(c="up"),c&&t.createEvent("flick",e,{direction:c})}})}(g),function(){if(!g.support.touch){var t={};g(document).on("touchend","a",function(){t[this._gesture_id]=!0}).on("click","a",function(e){t[this._gesture_id]||e.preventDefault(),t[this._gesture_id]=!1})}}(g);
//@ sourceMappingURL=dist/gesture.min.js.map